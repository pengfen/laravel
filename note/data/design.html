数据库结构设计的步骤

需求分析
全面了解产品设计的存储需求
存储需求
数据处理需求
数据的安全性和完整性

逻辑设计
设计数据的逻辑存储结构
数据实体之间的逻辑关系 解决数据冗余和数据维护异常

物理设计
根据所使用的数据库特点进行表结构设计
关系型数据库 Oracle SQLServer Mysql postgresSQL
非关系型数据库 mongo Redis Hadoop
存储引擎 Innodb

维护优化 根据实现情况对索引 存储结构等进行优化

数据库设计范式
设计出没有数据冗余和数据维护异常的数据库结构

什么叫做反范式化设计
反范式化是针对范式化而言的 在前面介绍了数据库设计的范式
所谓的反范式化就是为了性能和读取效率的考虑而适当的对数据库设计
范式的要求进行违反 而允许存在少量的数据冗余 换句话来说反范式就是使用
空间来换取时间

图书在线销售网站数据库的反范式化改造
商品信息:{商品名称,出版社名称,图书价格,图书描述,作者}
分类信息:{分类名称,分类描述}
商品分类关系:{商品名称,分类名称}

商品信息:{商品名称,分类名称,出版社名称,图书价格,图书描述,作者}
分类信息:{分类名称,分类描述}

订单表:{订单编号,下单用户名,下单日期,支付金额,物流单号}
订单商品关联表:{订单编号,订单商品分类,订单商品名,商品数量}

订单表:{订单编号,下单用户名,手机号,下单日期,支付金额,物流单号,订单金额}
订单商品关联表:{订单编号,订单商品分类,订单商品名,商品数量,商品单价}

反范式化改后的查询
编写SQL查询出每一个用户的订单总金额
select 下单用户名,sum(订单金额) from 订单表 group by 下单用户名;

编写SQL查询出下下单用户和订单详情
select a.订单编号,a.用户名,a.手机号,b.商品名称,b.商品单价,b.商品数量 from 订单表 a join 订单商品关联表 b on a.订单编号 = b.订单编号;

不能完全按照范式化的要求进行设计
考虑以后如何使用表

范式化设计的优缺点
优点
可以尽量的减少数据冗余 数据表更新快体积小
范式化的更新操作比反范式化更快
范式化的表通常比反范式化更小

缺点
对于查询需要对多个表进行关联
更难进行索引优化

反范式设计的优缺点
优点
可以减少表的关联
可以更好的进行索引优化
缺点
存在数据冗余及数据维护异常
对数据的修改需要更多的成本

物理设计
根据所选择的关系型数据库的特点对逻辑模型进行存储结构设计

物理设计涉及的内容
定义数据库 表及字段的命名规范
选择合适的存储引擎
为表中的字段选择合适的数据类型
建立数据库结构

定义数据库 表及字段的命名规范
数据库 表及字段的命名要遵守可读性原则
数据库 表及字段的命名要遵守表意性原则
数据库 表及字段的命名要遵守长名原则

选择合适的存储引擎
存储引擎     事务    锁粒度                主要应用                      忌用
MYISAM       不支持  支持并发插入的表级锁  select insert                 读写操作频繁
MRG_MYISAM   不支持  支持并发插入的表级锁  分段归档 数据仓库             全局查找过多的场景
innodb       支持    支持MVCC的行级锁      事务处理                      无
Archive      不支持  行级锁                日志记录 只支持insert select  需要随机读取 更新 删除
Ndb cluster  支持    行级锁                高可用性                      大部分应用

为表中的字段选择合适的数据类型
当一个列可以选择多种数据类型时 应该优先考虑数字类型 其次是日期或二进制类型
最后是字符类型 对于相同级别的数据类型 应该优先选择占用空间小的数据类型

如何选择正确的整数类型
列表型     存储空间  取值范围signed          unsigned
tinyint    1字节     -128~127                0~255
smallint   2字节     -32768~32767            0~65535
mediumint  3字节     -8388608~8388607        0~16777215
int        4字节     -2147483648~2147483647  0~4294967295
bigint     8字节     -9223372036854775808~   0~18446744073709551615
                     92233720368547758

物理设计 (存储空间 存储引擎 数据类型) 
innodb 为表中的每个列选择合适的类型 如何选择表的主键

如何为Innodb选择主键
主键应该尽可能的小
主键应该是顺序增长的
Innodb的主键和业务主键可以不同

数据库结构 (查询性能要求 范式化要求)
如何从数据库架构方面优化数据库
维护和优化放到索引和sql优化部分讲解

数据库设计简介
什么是数据库设计
简单来说 数据库设计就是根据业务系统的具体需要 结合我们所选用的DBMS(数据库管理系统)
为这个业务系统构造出最优的数据存储模型 并建立好数据库中的表结构及表与之间的关联关系的过程
使之能有效的对应用系统中的数据进行存储 并可以高效的对已经存储的数据进行访问

数据库设计简介
为什么要进行数据库设计
优良的设计        糟糕的设计
减少数据冗余      存在大量数据冗余
避免数据维护异常  存在数据插入 更新 删除异常
节约存储空间      浪费大量存储空间
高效的访问        访问数据低效

需求分析 --- 逻辑设计 --- 物理设计 --- 维护优化
数据库需求的作用点
1. 数据是什么  2.数据有哪些属性  3.数据和属性各自的特点有哪些
逻辑设计
使用ER图对数据库进行逻辑建模
物理设计
根据数据库自身的特点把逻辑设计转换为物理设计
维护优化
1.新的需求进行建表  2.索引优化  3.大表拆分

为什么要进行需求分析
1.了解系统中所要存储的数据
2.了解数据的存储特点
3.了解数据的生命周期

要搞清楚的一些问题
1.实体及实体之间的关系(1对1,1对多,多对多)
2.实体所包含的属性有什么
3.那些属性或属性的组合可以唯一标识一个实体

实例演示
以一个小型的电子商务网站为例 在这个电子商务网站的系统中包括了几个核心模块
用户模块 商品模块 订单模块 购物车模块 供应商模块
用户模块
用于记录注册用户信息
包括属性 用户名 密码 电话 邮箱 身价证号 地址 姓名 昵称 ...
可选唯一标识属性 用户名 身份证 电话
存储特点 随系统上线时间逐渐增加 需要永久存储

商品模块
用于记录网站中所销售的商品信息
包括属性 商品编码 商品名称 商品描述 商品品类 供应商名称 重量 有效期 价格 ...
可选唯一标识属性 商品名称 供应商名称 商品编码
存储特点 对于下线商品可以归档存储

订单模块
用于用户订单商品的信息
包括属性 订单号 用户姓名 用户电话 收货地址 商品编号 商品名称 数量 价格 订单状态 支付状态 订单类型
可选唯一标识属性 订单号
存储特点 永久存储(分表 分库存储)

购物车模块
用于保存用户购物时选对的商品
包括属性 用户名 商品编号 商品名称 商品价格 商品描述 商品分类 加入时间 商品数量
可选唯一标识属性 (用户名 商品编号 加入时间), 购物车编号
存储特点 不用永久存储(设置归档 清理规则)

供应商模块
用于保存所销售商品的供应商信息
包括属性 供应商编号 供应商名称 联系人 电话 营业执照号 地址 法人
可选唯一标识属性 供应商编号 营业执照号
存储特点 永久存储

用户 --- 一对多 --- 订单   --- 多对多 --- 商品 --- 多对多 --- 供应商
     --- 一对多 --- 购物车 --- 多对多 ---
	  
逻辑设计是做什么的
1.将需求转化为数据库的逻辑模型
2.通过ER图的型式对逻辑模型进行展示
3.同所选用的具体的DBMS系统无关

名词解释
关系    一个关系对应通常所说的一张表
元组    表中的一行即为一个元组
属性    表中的一列即为一个属性 每一个属性都有一个名称 称为属性名
候选码  表中的某个属性组 它可以唯一确定一个元组
主码    一个关系有多个候选码 选定其中一个为主码
域      属性的取值范围
分量    元组中一个属性值

ER图例说明
矩形 表示实体集 矩形内写实体集的名字
菱形 表示联系集
椭圆 表示实体的属性
线段 将属性连接到实体集 或将实体集连接到联系集
