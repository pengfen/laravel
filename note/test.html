#!/usr/bin/env php
<?php

// gen controller template
// file name ---> $argv[1]
if (!isset($argv[1])) {
    echo 'exec ./test filename';
    exit;
}
$filename = $argv[1].'.php';

exec('touch '.$filename);

$str=<<<END
<?php

namespace App\Http\Controllers;
use \App\Http\Controllers\Controller;
use \App\Enums as E;
use \App\Helper\Config;

END;
$data = $str.PHP_EOL."class $argv[1] extends Controller".PHP_EOL.'{'.PHP_EOL.'}';
file_put_contents($filename, $data);

$dist = '/home/ak/admin_yb1v1/app/Http/Controllers/';
exec('mv '.$filename.' '.$dist)

#chmod 755 gen_c
#./gen_c a

#!/usr/bin/env php
<?php

// gen view template
// $argv[1] ---> controller  $argv[2] ---> action
// file name ---> $argv[2]
if (!isset($argv[2])) {
    echo 'exec ./test controller action';
    exit;
}
$filename = $argv[2].'.blade.php';

exec('touch '.$filename);

$data = "
@entends('layouts.app')
@section('content')
<section class='content'>
    <div> <!-- search ... -->
    </div>
    <hr/>
    <table class=\"common-table\">
    </table>
@include('layouts.page')
</section>
@endsection";

file_put_contents($filename, $data);

$dist = '/home/ak/admin_yb1v1/resources/views/'.$argv[1];
exec('mkdir '.$dist);
$dist .= '/';
exec('mv '.$filename.' '.$dist);

# chmod 755 gen_v
# ./gen_v c v

// 数据库-表管理
alter table table_name nodify column column_name comment comment_name
alter table table_name comment comment_name
show full columns frome table_name
show create table table_name

// 获取所有的父id  数据字段 id parentid  获取数据 id, parentid,parentid...
// php artisan make:console get_agent_parent_id
    protected $signature = 'command:get_agent_parent_id';

    protected $description = '获取agent表中的父ID';

    public function handle()
    {
        //
        //dd('调用成功');
        $task = new \App\Console\Tasks\TaskController();

        $paret_map=$task->t_agent->get_parent_map();
        foreach($paret_map as $id => $v ) {
            list( $error_flag, $id_map )=$this->get_id($id, $paret_map);
            if ($error_flag) {
                echo "id $id: error_flag:$error_flag, list:  ". join(",", array_keys($id_map) ). "\n";
            }
        }
        // $this->get_id($res);
    }

    function get_id($id , $parent_map )
    {
        $id_map=[ ];
        $id_map[$id]=true;
        $error_flag=false;
        $tmpid=$id;
        do{
            $tmpid=@$parent_map[$tmpid]["parentid"];
            if (isset ($id_map[ $tmpid]) ) {
                $error_flag=true;
                break;
            }
            $id_map[$tmpid] =true;

        }while (!$tmpid==0 );
        return array( $error_flag,  $id_map   );
    }

$sql = $this->gen_sql_new("select id,parentid from %s",self::DB_TABLE_NAME);
return $this->main_get_list($sql,function( $item){
    return $item["id"];
} );

sql
    select teacherid, phone, train_through_new_time
    from db_weiyi.t_teacher_info t where is_test_user=0 and
    not exists (select 1 from db_weiyi.t_teacher_flow where t.teacherid=teacherid)

    select sum(train_through_new_time>0) from t_teacher_flow => 32
    select count(*) from t_teacher_flow => 81

