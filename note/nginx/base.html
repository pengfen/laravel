Nginx简述
Nginx是一个开源且高性能 可靠的HTTP中间件 代理服务

为什么选择nginx
原因一 IO多路复用epoll
什么是IO复用
什么是IO多路复用
什么是epoll IO多路复用的实现方式select poll epoll
什么是select 应用 ---Read请求可用--- 内核 ---初始化I/O 数据拷贝--- Read完成
select缺点
1.能够监视文件描述符的数量存在最大限制
2.线性扫描效率低下

epoll模型
1.每当FD就绪 采用系统的回调函数之间将fd放入 效率更高
2.最大连接无限制

轻量级
功能模块少 代码模块化
CPU亲和(affinity)
什么是CPU亲和 是一种把CPU核心和Nginx工作进程绑定方式 把每个worker进程固定在一个cpu上执行
减少切换cpu的cache miss 获得更好的性能
sendfile

Nginx快速搭建与基本参数使用
Mainline version 开发版
Stable version 稳定版
Legacy version 历史版本

nginx.org
nginx-1.12.1
stable version
复制yum源
vi /etc/yum.repos.d/nginx.repo
[nginx]
name=nginx repo
baseurl=http://nginx.org/packages/OS/OSRELEASE/$basearch/
gpgcheck=0
enabled=1
修改url /packages/centos/7/$basearch/
yum list | grep nginx
yum install nginx
nginx -v

基本参数使用
安装目录
编译参数
Nginx基本配置语法
rpm -q | nginx
/etc/logrotate.d/nginx 配置文件 Nginx日志轮转 用于logrotate服务的日志切割

/etc/nginx 配置文件 Nginx主配置文件
/etc/nginx/nginx.conf
/etc/nginx/conf.d
/etc/nginx/conf.d/default.conf
/etc/nginx/mime.types 配置文件 设置http协议的Content-Type与扩展名对应关系
/usr/lib/systemd/system/nginx-debug.service 配置文件 用于配置出系统守护进程管理器管理方式
/usr/lib/systemd/system/nginx.service
/etc/sysconfig/nginx
/etc/sysconfig/nginx-debug
/usr/sbin/nginx 命令 Nginx服务的启动管理的终端命令
/usr/sbin/nginx-debug
/etc/nginx/koi-utf 配置文件 编码转换映射转化文件
/etc/nginx/koi-win
/etc/nginx/win-utf
/usr/lib64/nginx/modules 目录 Nginx模块目录
/etc/nginx/modules
/usr/share/doc/nginx-1.12.0 文件目录 Nginx的手册和帮助文件
/usr/share/doc/nginx-1.12.0/COPYRIGHT
/usr/share/man/man8/nginx.8.gz
/var/cache/nginx 目录 Nginx的缓存目录
/var/log/nginx 目录 Nginx的日志目录

安装编译参数
--prefix=/etc/nginx 安装目的目录或路径
--sbin-path=/usr/sbin/nginx
--modules-path=/usr/lib64/nginx/modules
--conf-path=/etc/nginx/nginx.conf
--error-log-path=/var/log/nginx/error.log
--http-log-path=/var/log/nginx/access.log
--pid-path=/var/run/nginx.pid
--lock-path=/var/run/nginx.lock
--http-client-body-temp-path=/var/cache/nginx/client_temp 执行对应模块时 Nginx所保留的临时性文件
--http-proxy-temp-path=/var/cache/nginx/proxy_temp
--http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp
--http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp
--http-scgi-temp-path=/var/cache/nginx/scgi_temp
--user=nginx 设定Nginx进程启动的用户和组用户
--group=nginx
--with-cc-opt=parameters 设置额外的参数将被添加到CFLAGS变量
--with-ld-opt=parameters 设置附加的参数 链接系统库

nginx.conf配置文件
Nginx默认配置语法
user 设置nginx服务的系统使用用户
worker_processes 工作进程数
error_log nginx的错误日志
pid nginx服务启动时候pid

events worker_connections 每个进程允许最大连接数
use 工作进程数

systemctl restart nginx.service
systemctl reload nginx.service

1.HTTP请求
客户端 ---request,response--- 服务端
request 包括请求行 请求头部 请求数据
response 包括状态行 消息报头 响应正文

2.Nginx日志类型
包括 error.log access_log
log_format
Syntax: log_format name [escape=default|json] string ...;
Default: log_format combined "...";
Context:http

error_log /var/log/nginx/error.log warn;
access_log /var/log/nginx/access.log main;
log_format main '$remote_addr - $remote_user [$time_local] "$request"'
'$status $body_bytes_sent "$http_referer" '
'"$http_user_agent" "$http_x_forwarded_for"';
tail -n200 /var/log/nginx/access.log

Nginx变量
HTTP请求变量 - arg_PARAMETER http_HEADER sent_http_HEADER
内置变量 - Nginx内置的
自定义变量 - 自己定义

Nginx模块讲解
Nginx官方模块
第三方模块

安装编译参数讲解
--with-http_stub_status_module Nginx的客户端状态
http_stub_status_module配置
Syntax: stub_status;
Default: 
Context:server,location

默认模块讲解
--with-http_random_index_module 目录中选择一个随机主页
random_index_module
Syntax: random_index on | off;
Default: random_index off;
Context:location

--with-http_sub_module HTTP内容替换
http_sub_module
Syntax: sub_filter string replacement;
Default:
Context:http,server,location

Syntax: sub_filter_last_modified on|off;
Default:sub_filter_last_modified off;
Context:http,server,location

Syntax: sub_filter_once on|off;
Default: sub_filter_once on;
Context:http,server,location

location / {
    sub_filter '<a>imooc' '<a>IMOOC';
}

Nginx的请求限制
连接频率限制 limit_conn_module
请求频率限制 limit_req_module

HTTP协议的连接与请求
HTTP协议版本  连接关系
HTTP1.0       TCP不能复用
HTTP1.1       顺序性TCP复用
HTTP2.0       多路复用TCP复用
HTTP请求建立在一次TCP连接基础上
一次TCP请求至少产生一次HTTP请求

连接限制
Syntax: limit_conn_zone key zone=name:size;
Default:
Context:http

Syntax: limit_conn_zone number;
Default:
Context:http,server,location
